{
  "hash": "47c2744b7de39df584abaf11f76feafe",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 4e - plotting for project poster\"\ndate: March 22, 2024\ndate-modified: \"last-modified\"\nauthor: \"Imran Ibrahim\"\ntoc: true\nexecute: \n  eval: true\n  echo: true\n  freeze: true\n  warning: false\n  message: false\n---\n\n\n# Emerging Hot Spot Analysis: sfdep methods\n\n# Data Loading and Prep\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, dplyr , \n               sf, lubridate,plotly,\n               tmap, spdep, sfdep, patchwork, knitr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmmr_shp_mimu_2 <-  st_read(dsn = \"data/geospatial3\",  \n                  layer = \"mmr_polbnda_adm2_250k_mimu\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `mmr_polbnda_adm2_250k_mimu' from data source \n  `C:\\imranmi\\ISSS608-VAA\\Take-home-ex\\Take-home-Ex4e\\data\\geospatial3' \n  using driver `ESRI Shapefile'\nSimple feature collection with 80 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 92.1721 ymin: 9.696844 xmax: 101.17 ymax: 28.54554\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n\n## Data Wrangle for quarterly data\n\nAs per project requirements, we will sync the time frame for this analysis to be the same as our previous LISA analysis. Therefore, we will set up the data set to be for 2021-2023, and in quarterly periods\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEvents_2 <- read_csv(\"data/df1_complete.csv\")\n```\n:::\n\n\nSince this data set has been filled up for missing values, using `tidyr::complete()` , I can proceed to use the standard spacetime constructor ie [`spacetime()`](https://sfdep.josiahparry.com/reference/spacetime.html)\n\nFirst, loc_col identifier needs to be the same name for both data and shape file.\n\nEvent_type == Battles\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEvents_2 <- Events_2 %>%\n        filter(event_type == \"Battles\") %>%\n        rename(DT=admin2) %>%\n        select(-event_type, -year, -Fatalities) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nQuarterly_spt <- spacetime(Events_2, mmr_shp_mimu_2,\n                      .loc_col = \"DT\",\n                      .time_col = \"quarter\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nis_spacetime_cube(Quarterly_spt)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n:::\n\n\n# Computing Gi\\*\n\nNext, we will compute the local Gi\\* statistics.\n\n### Deriving the spatial weights\n\nThe code below will be used to identify neighbors and to derive an inverse distance weights.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nQuarterly_nb <- Quarterly_spt %>%\n  activate(\"geometry\") %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                  scale = 1,\n                                  alpha = 1),\n         .before = 1) %>%\n  set_nbs(\"nb\") %>%\n  set_wts(\"wt\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#for Quarterly admin 2\ngi_stars3 <- Quarterly_nb %>% \n  group_by(quarter) %>% \n  mutate(gi_star = local_gstar_perm(\n    Incidents, nb, wt)) %>% \n  tidyr::unnest(gi_star)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngi_stars3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 960 × 15\n# Groups:   quarter [12]\n   quarter DT      Incidents nb    wt    gi_star cluster    e_gi  var_gi std_dev\n     <dbl> <chr>       <dbl> <lis> <lis>   <dbl> <fct>     <dbl>   <dbl>   <dbl>\n 1   20211 Hintha…         0 <int> <dbl>  -0.938 Low     0.0101  1.70e-4 -0.776 \n 2   20211 Labutta         0 <int> <dbl>  -0.645 Low     0.00613 1.91e-4 -0.444 \n 3   20211 Maubin          0 <int> <dbl>  -0.938 Low     0.00945 1.42e-4 -0.795 \n 4   20211 Myaung…         0 <int> <dbl>  -0.801 Low     0.00825 1.83e-4 -0.610 \n 5   20211 Pathein         0 <int> <dbl>  -0.801 Low     0.00861 1.74e-4 -0.652 \n 6   20211 Pyapon          0 <int> <dbl>  -0.801 Low     0.00766 1.56e-4 -0.613 \n 7   20211 Bago            1 <int> <dbl>   0.321 Low     0.0109  1.39e-4  0.501 \n 8   20211 Taungoo         8 <int> <dbl>   0.432 High    0.0210  1.23e-4 -0.280 \n 9   20211 Pyay            0 <int> <dbl>  -0.337 Low     0.00906 1.74e-4 -0.105 \n10   20211 Thayar…         0 <int> <dbl>  -0.270 Low     0.00926 1.78e-4 -0.0474\n# ℹ 950 more rows\n# ℹ 5 more variables: p_value <dbl>, p_sim <dbl>, p_folded_sim <dbl>,\n#   skewness <dbl>, kurtosis <dbl>\n```\n:::\n:::\n\n\n# Mann-Kendall Test\n\nWith these Gi\\* measures we can then evaluate each location for a trend using the Mann-Kendall test.\n\nThe code chunk below uses Hinthada region.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbg3 <- gi_stars3 %>% \n  ungroup() %>% \n  filter(DT == \"Hinthada\") |> \n  select(DT, quarter, gi_star)\n```\n:::\n\n\nNext, we plot the result by using ggplotly() of plotly package.\n\n**Hinthada district quarterly**\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- ggplot(data = cbg3, \n       aes(x = quarter, \n           y = gi_star)) +\n  geom_line() +\n  theme_light()\n\nggplotly(p3)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-c838290f7ed0217e36e5\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c838290f7ed0217e36e5\">{\"x\":{\"data\":[{\"x\":[20211,20212,20213,20214,20221,20222,20223,20224,20231,20232,20233,20234],\"y\":[-0.93751257944361199,-1.27667486743152,-1.685214447206653,-1.4719409717472254,-1.6682469649078393,-1.6589364706864278,-1.9726482068457223,-1.8280863415982889,-1.5849030767048147,-1.6875167576840768,-1.6749279580579677,-1.4351478905503112],\"text\":[\"quarter: 20211<br />gi_star: -0.9375126\",\"quarter: 20212<br />gi_star: -1.2766749\",\"quarter: 20213<br />gi_star: -1.6852144\",\"quarter: 20214<br />gi_star: -1.4719410\",\"quarter: 20221<br />gi_star: -1.6682470\",\"quarter: 20222<br />gi_star: -1.6589365\",\"quarter: 20223<br />gi_star: -1.9726482\",\"quarter: 20224<br />gi_star: -1.8280863\",\"quarter: 20231<br />gi_star: -1.5849031\",\"quarter: 20232<br />gi_star: -1.6875168\",\"quarter: 20233<br />gi_star: -1.6749280\",\"quarter: 20234<br />gi_star: -1.4351479\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.228310502283104,\"r\":7.3059360730593621,\"b\":40.182648401826491,\"l\":48.949771689497723},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[20209.849999999999,20235.150000000001],\"tickmode\":\"array\",\"ticktext\":[\"20210\",\"20215\",\"20220\",\"20225\",\"20230\",\"20235\"],\"tickvals\":[20210,20215,20220,20225,20230,20235],\"categoryorder\":\"array\",\"categoryarray\":[\"20210\",\"20215\",\"20220\",\"20225\",\"20230\",\"20235\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"quarter\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-2.0244049882158279,-0.88575579807350646],\"tickmode\":\"array\",\"ticktext\":[\"-1.8\",\"-1.5\",\"-1.2\",\"-0.9\"],\"tickvals\":[-1.8000000000000005,-1.5000000000000004,-1.2000000000000004,-0.90000000000000036],\"categoryorder\":\"array\",\"categoryarray\":[\"-1.8\",\"-1.5\",\"-1.2\",\"-0.9\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"gi_star\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(179,179,179,1)\",\"width\":0.66417600664176002,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"76682c057437\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"76682c057437\",\"visdat\":{\"76682c057437\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nMann Kendall test for **Hinthada district-quarterly**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbg3 %>%\n  summarise(mk = list(\n    unclass(\n      Kendall::MannKendall(gi_star)))) %>% \n  tidyr::unnest_wider(mk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 5\n     tau    sl     S     D  varS\n   <dbl> <dbl> <dbl> <dbl> <dbl>\n1 -0.242 0.304   -16  66.0  213.\n```\n:::\n:::\n\n\nValues of Mann Kendall test.\n\n|        |                         |\n|--------|-------------------------|\n| `tau`  | Kendall’s tau statistic |\n| `sl`   | two-sided p-value       |\n| `S`    | Kendall Score           |\n| `D`    | denominator, tau=S/D    |\n| `varS` | variance of S           |\n\n\n::: {.cell}\n\n```{.r .cell-code}\nehsa3 <- gi_stars3 %>%\n  group_by(DT) %>%\n  summarise(mk = list(\n    unclass(\n      Kendall::MannKendall(gi_star)))) %>%\n  tidyr::unnest_wider(mk)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nehsa3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 80 × 6\n   DT                              tau     sl     S     D  varS\n   <chr>                         <dbl>  <dbl> <dbl> <dbl> <dbl>\n 1 Bago                        -0.0606 0.837     -4  66.0  213.\n 2 Bawlake                     -0.333  0.150    -22  66.0  213.\n 3 Bhamo                       -0.303  0.193    -20  66.0  213.\n 4 Danu Self-Administered Zone -0.394  0.0865   -26  66.0  213.\n 5 Dawei                        0.515  0.0236    34  66.0  213.\n 6 Det Khi Na                  -0.212  0.373    -14  66.0  213.\n 7 Falam                       -0.333  0.150    -22  66.0  213.\n 8 Gangaw                       0.121  0.631      8  66.0  213.\n 9 Hakha                       -0.0303 0.945     -2  66.0  213.\n10 Hinthada                    -0.242  0.304    -16  66.0  213.\n# ℹ 70 more rows\n```\n:::\n:::\n\n\n## Arrange to show significant emerging hot/cold spots\n\n**Admin 2 districts-quarterly**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemerging3 <- ehsa3 %>% \n  arrange(sl, abs(tau)) %>% \n  slice(1:5)\n\nprint(emerging3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 6\n  DT               tau      sl     S     D  varS\n  <chr>          <dbl>   <dbl> <dbl> <dbl> <dbl>\n1 Mandalay       0.667 0.00319    44  66.0  213.\n2 Maubin        -0.667 0.00319   -44  66.0  213.\n3 Pyapon        -0.667 0.00319   -44  66.0  213.\n4 Pyinoolwin     0.636 0.00493    42  66.0  213.\n5 Yangon (West) -0.636 0.00493   -42  66.0  213.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nemerging3 <- ehsa3 %>% \n  arrange(sl, abs(tau)) %>% \n  slice(1:5)\n\n# Print as a more formal table\nkable(emerging3)\n```\n\n::: {.cell-output-display}\n|DT            |        tau|        sl|   S|        D|     varS|\n|:-------------|----------:|---------:|---:|--------:|--------:|\n|Mandalay      |  0.6666666| 0.0031919|  44| 66.00001| 212.6667|\n|Maubin        | -0.6666666| 0.0031920| -44| 66.00001| 212.6667|\n|Pyapon        | -0.6666666| 0.0031920| -44| 66.00001| 212.6667|\n|Pyinoolwin    |  0.6363636| 0.0049314|  42| 66.00001| 212.6667|\n|Yangon (West) | -0.6363636| 0.0049315| -42| 66.00001| 212.6667|\n:::\n:::\n\n\nSince above identifies the top five districts of emerging hot spots, we can also do a combined plot of their GI\\* trends over the 3 years\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ncbg1st <- gi_stars3 %>% \n  ungroup() %>% \n  filter(DT == \"Mandalay\") |> \n  select(DT, quarter, gi_star)\n\ncbg2nd <- gi_stars3 %>% \n  ungroup() %>% \n  filter(DT == \"Maubin\") |> \n  select(DT, quarter, gi_star)\n\ncbg3rd <- gi_stars3 %>% \n  ungroup() %>% \n  filter(DT == \"Pyapon\") |> \n  select(DT, quarter, gi_star)\n\ncbg4th <- gi_stars3 %>% \n  ungroup() %>% \n  filter(DT == \"Pyinoolwin\") |> \n  select(DT, quarter, gi_star)\n\ncbg5th <- gi_stars3 %>% \n  ungroup() %>% \n  filter(DT == \"Yangon (West)\") |> \n  select(DT, quarter, gi_star)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\np1 <- ggplot(data = cbg1st, \n       aes(x = quarter, \n           y = gi_star)) +\n  geom_line(colour = \"red\", size = 1.5) +\n  theme_minimal() +\n  ggtitle(\"Gi* Trends for Mandalay district\")\n\np2 <- ggplot(data = cbg2nd, \n       aes(x = quarter, \n           y = gi_star)) +\n  geom_line(colour = \"red\", size = 1.5) +\n  theme_minimal() +\n  ggtitle(\"Gi* Trends for Maubin district\")\n\np3 <- ggplot(data = cbg3rd, \n       aes(x = quarter, \n           y = gi_star)) +\n  geom_line(colour = \"red\", size = 1.5) +\n  theme_minimal() +\n  ggtitle(\"Gi* Trends for Pyapon district\")\n\np4 <- ggplot(data = cbg4th, \n       aes(x = quarter, \n           y = gi_star)) +\n  geom_line(colour = \"red\", size = 1.5) +\n  theme_minimal() +\n  ggtitle(\"Gi* Trends for Pyinoolwin district\")\n\np5 <- ggplot(data = cbg5th, \n       aes(x = quarter, \n           y = gi_star)) +\n  geom_line(colour = \"red\", size = 1.5) +\n  theme_minimal() +\n  ggtitle(\"Gi* Trends for Yangon(West) district\")\n```\n:::\n\n::: {.cell .column-body-outset-right}\n\n```{.r .cell-code}\npatchwork <- (p1+p2+p3+p4+p5)\n\npatchwork\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex4e_files/figure-html/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n## Performing Emerging Hotspot Analysis\n\nWe will perform EHSA analysis by using [`emerging_hotspot_analysis()`](https://sfdep.josiahparry.com/reference/emerging_hotspot_analysis.html) of sfdep package. It takes a spacetime object x (i.e. spt1_complete, sp2_complete, quarterly_spt), and the quoted name of the variable of interest (i.e. Incidents) for .var argument.\n\nThe **k argument is used to specify the** **number of time lags** which is set to 1 by default.\n\nLastly, **nsim map** **numbers of simulation** to be performed.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nehsa3_99 <- emerging_hotspot_analysis(\n  x = Quarterly_spt, \n  .var = \"Incidents\", \n  k = 1, \n  nsim = 99\n)\n\nehsa3_199 <- emerging_hotspot_analysis(\n  x = Quarterly_spt, \n  .var = \"Incidents\", \n  k = 1, \n  nsim = 199\n)\n\nehsa3_299 <- emerging_hotspot_analysis(\n  x = Quarterly_spt, \n  .var = \"Incidents\", \n  k = 1, \n  nsim = 299\n)\n\nehsa3_399 <- emerging_hotspot_analysis(\n  x = Quarterly_spt, \n  .var = \"Incidents\", \n  k = 1, \n  nsim = 399\n)\n\nehsa3_499 <- emerging_hotspot_analysis(\n  x = Quarterly_spt, \n  .var = \"Incidents\", \n  k = 1, \n  nsim = 499\n)\n```\n:::\n\n\n### Visualising the distribution of EHSA classes\n\n**Admin2 districts - quarterly**\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\np6 <- ggplot(data = ehsa3_99,\n       aes(x = classification)) +\n  geom_bar() +\n  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 4, position = position_stack(vjust = 1)) +\n  labs(title = \"Distribution of ESHA classes - 99 simulations\") +\n  theme(plot.title = element_text(size = 20)) +\n  theme_minimal() \n\n\np7 <- ggplot(data = ehsa3_199,\n       aes(x = classification)) +\n  geom_bar() +\n  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 4, position = position_stack(vjust = 1)) +\n  labs(title = \"Distribution of ESHA classes - 199 simulations\") +\n  theme(plot.title = element_text(size = 20)) +\n  theme_minimal() \n\np8 <- ggplot(data = ehsa3_299,\n       aes(x = classification)) +\n  geom_bar() +\n  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 4, position = position_stack(vjust = 1)) +\n  labs(title = \"Distribution of ESHA classes - 299 simulations\") +\n  theme(plot.title = element_text(size = 20)) +\n  theme_minimal()\n\np9 <- ggplot(data = ehsa3_399,\n       aes(x = classification)) +\n  geom_bar() +\n  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 4, position = position_stack(vjust = 1)) +\n labs(title = \"Distribution of ESHA classes - 399 simulations\") +\n  theme(plot.title = element_text(size = 20)) +\n  theme_minimal()\n\n#p10 <- ggplot(data = ehsa3_499,\n #      aes(x = classification)) +\n#  geom_bar() +\n#  geom_text(stat = 'count', aes(label = ..count..), vjust = -0.5, size = 4, position = position_stack#(vjust = 1)) +\n#  labs(title = \"Distribution of ESHA classes - 499 simulations\") +\n#  theme(plot.title = element_text(size = 20)) +\n#  theme_minimal()\n```\n:::\n\n::: {.cell .column-body-outset-right}\n\n```{.r .cell-code}\npatchwork2 <- p6/p7\n\npatchwork2\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex4e_files/figure-html/unnamed-chunk-22-1.png){width=1152}\n:::\n:::\n\n::: {.cell .column-body-outset-right}\n\n```{.r .cell-code}\npatchwork3 <- p8/p9\n\npatchwork3\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex4e_files/figure-html/unnamed-chunk-23-1.png){width=1152}\n:::\n:::\n\n\n### Visualising EHSA\n\nIn this section, we will learn how to visualise the geographic distribution EHSA classes. However, before we can do so, we need to join *mmr_shp_mimu2 & ehsa3)* together by using the code chunk below.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmmr_ehsa99 <- mmr_shp_mimu_2 %>%\n  left_join(ehsa3_99,\n            by = join_by(DT == location))\n\nmmr_ehsa199 <- mmr_shp_mimu_2 %>%\n  left_join(ehsa3_199,\n            by = join_by(DT == location))\n\nmmr_ehsa299 <- mmr_shp_mimu_2 %>%\n  left_join(ehsa3_299,\n            by = join_by(DT == location))\n\nmmr_ehsa399 <- mmr_shp_mimu_2 %>%\n  left_join(ehsa3_399,\n            by = join_by(DT == location))\n```\n:::\n\n\nfiltering the significant p-values\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nehsa_sig99 <- mmr_ehsa99  %>%\n  filter(p_value < 0.05)\n\nehsa_sig199 <- mmr_ehsa199  %>%\n  filter(p_value < 0.05)\n\nehsa_sig299 <- mmr_ehsa299  %>%\n  filter(p_value < 0.05)\n\nehsa_sig399 <- mmr_ehsa399  %>%\n  filter(p_value < 0.05)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nehsa1 <- tm_shape(mmr_ehsa99) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(ehsa_sig99) +\n  tm_fill(\"classification\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"Emerging Hot Spot Map, 2021-2023\",\n            title = \"99 simulations\",\n            main.title.size = 1.2,\n            legend.height = 0.60, \n            legend.width = 5.0,\n            legend.outside = FALSE,\n            legend.position = c(\"left\", \"bottom\"))\n\nehsa2 <- tm_shape(mmr_ehsa199) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(ehsa_sig199) +\n  tm_fill(\"classification\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"Emerging Hot Spot Map, 2021-2023\",\n            title = \"199 simulations\",\n            main.title.size = 1.2,\n            legend.height = 0.60, \n            legend.width = 5.0,\n            legend.outside = FALSE,\n            legend.position = c(\"left\", \"bottom\"))\n\nehsa3 <- tm_shape(mmr_ehsa299) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(ehsa_sig299) +\n  tm_fill(\"classification\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"Emerging Hot Spot Map, 2021-2023\",\n            title = \"299 simulations\",\n            main.title.size = 1.2,\n            legend.height = 0.60, \n            legend.width = 5.0,\n            legend.outside = FALSE,\n            legend.position = c(\"left\", \"bottom\"))\n\nehsa4 <- tm_shape(mmr_ehsa399) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(ehsa_sig399) +\n  tm_fill(\"classification\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"Emerging Hot Spot Map, 2021-2023\",\n            title = \"399 simulations\",\n            main.title.size = 1.2,\n            legend.height = 0.60, \n            legend.width = 5.0,\n            legend.outside = FALSE,\n            legend.position = c(\"left\", \"bottom\"))\n```\n:::\n\n::: {.cell .column-body-outset-right}\n\n```{.r .cell-code}\ntmap_arrange(ehsa1, ehsa2, \n             asp = 1,\n             ncol=2, nrow=1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex4e_files/figure-html/unnamed-chunk-27-1.png){width=1152}\n:::\n:::\n\n::: {.cell .column-body-outset-right}\n\n```{.r .cell-code}\ntmap_arrange(ehsa3, ehsa4, \n             asp = 1,\n             ncol=2, nrow=1)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex4e_files/figure-html/unnamed-chunk-28-1.png){width=1152}\n:::\n:::\n",
    "supporting": [
      "Take-home_Ex4e_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\r\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\r\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}